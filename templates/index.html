<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> <title>Dice Prediction Game</title>
    
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1641440800882293"
     crossorigin="anonymous"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=Roboto:wght@500;700&display=swap');
        
        * { box-sizing: border-box; user-select: none; -webkit-user-drag: none; }

        :root {
            --bg-color: #1a1a2e; 
            --board-color: #16213e;
            --accent-color: #0f3460; 
            --text-gold: #e94560; 
            --text-white: #ffffff;
        }
        
        body { 
            background-color: var(--bg-color); color: var(--text-white); 
            font-family: 'Roboto', sans-serif; margin: 0; 
            height: 100vh; width: 100vw;
            display: flex; flex-direction: column;
            overflow: hidden; 
        }

        /* --- [ë°˜ì‘í˜• ê´‘ê³  ë ˆì´ì•„ì›ƒ] --- */
        .ad-top-container, .ad-bottom-container {
            width: 100%; min-height: 90px;
            background: #0a0a12;
            display: flex; justify-content: center; align-items: center;
            flex-shrink: 0; z-index: 100;
            overflow: hidden;
        }

        .main-wrapper {
            flex: 1; 
            display: flex; 
            justify-content: center; 
            align-items: stretch;
            width: 100%; 
            overflow: hidden;
            padding: 10px;
            gap: 10px;
        }

        .ad-vertical-container {
            width: 160px; /* PC ì‚¬ì´ë“œë°” ë„ˆë¹„ ê³ ì • */
            background: #0a0a12;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            flex-shrink: 0;
            border-radius: 10px;
            overflow: hidden;
        }

        .game-container { 
            flex: 1; 
            max-width: 1200px; 
            display: flex; gap: 15px; 
            align-items: center; justify-content: center; 
            height: 100%; position: relative;
            min-width: 0;
        }

        /* --- [ëª¨ë°”ì¼ ëŒ€ì‘] --- */
        @media (max-width: 1024px) {
            .ad-vertical-container { display: none; } /* ëª¨ë°”ì¼ì—ì„œ ì¢Œìš° ê´‘ê³  ìˆ¨ê¹€ */
            .main-wrapper { padding: 5px; }
            .ad-top-container, .ad-bottom-container { min-height: 60px; }
        }

        /* --- ê¸°ì¡´ CSS --- */
        .side-panel { 
            width: 220px; height: 100%; max-height: 750px; background: var(--board-color); 
            border: 2px solid var(--accent-color); border-radius: 15px; 
            display: flex; flex-direction: column; position: relative; 
            transition: all 0.3s ease-in-out; overflow: visible; z-index: 90; padding: 0; flex-shrink: 0;
        }
        .side-panel.collapsed { width: 0; border-width: 0; margin: 0; opacity: 1; }
        .panel-content { padding: 15px; width: 220px; height: 100%; display: flex; flex-direction: column; transition: opacity 0.2s; opacity: 1; }
        .side-panel.collapsed .panel-content { opacity: 0; pointer-events: none; display: none; }
        .panel-title { font-family: 'Roboto', sans-serif; color: var(--text-white); text-align: center; width: 100%; font-size: 1.2rem; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px solid var(--accent-color); display: block; font-weight: bold; }
        
        .toggle-btn {
            position: absolute; top: 20px; width: 30px; height: 60px; 
            background: var(--accent-color); border: 2px solid var(--accent-color); color: var(--text-white); 
            display: flex; justify-content: center; align-items: center; cursor: pointer; z-index: 101; 
            font-size: 1.2rem; box-shadow: 0 0 5px rgba(0,0,0,0.5);
        }
        .history-toggle-btn { right: -30px; border-left: none; border-radius: 0 10px 10px 0; }
        .ranking-toggle-btn { left: -30px; border-right: none; border-radius: 10px 0 0 10px; }

        .scroll-list { flex: 1; overflow-y: auto; display: flex; flex-direction: column; gap: 8px; padding-right: 5px; }
        .scroll-list::-webkit-scrollbar { width: 6px; } 
        .scroll-list::-webkit-scrollbar-thumb { background: #555; border-radius: 3px; }
        .history-item, .ranking-item { background: rgba(255,255,255,0.05); border-radius: 8px; padding: 10px; width: 100%; display: flex; justify-content: center; align-items: center; border: 1px solid rgba(255,255,255,0.1); }
        .ranking-item { justify-content: space-between; }
        .rank-rank { color: var(--text-gold); width: 25px; font-weight: bold; }
        .rank-user { color: white; flex: 1; text-align: left; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; margin: 0 5px; }
        .rank-bal { color: #00ffcc; font-weight: bold; font-size: 0.8rem; }
        .rank-me { border: 1px solid var(--text-gold); background: rgba(233, 69, 96, 0.1); }
        .h-dice-group { display: flex; gap: 5px; } .h-die { font-size: 2rem; color: #eee; } 

        .game-board-border { 
            width: 100%; max-width: 1000px;
            height: 100%; max-height: 800px; 
            background: var(--board-color); padding: 10px; border-radius: 20px; 
            border: 4px solid var(--accent-color); 
            box-shadow: 0 0 40px rgba(0,0,0,0.5); 
            display: flex; flex-direction: column;
            position: relative; overflow-y: auto;
        }
        .game-board-inner { 
            border: 2px solid rgba(255,255,255,0.1); border-radius: 8px; padding: 5px; 
            display: flex; flex-direction: column; gap: 5px; flex: 1;
        }

        .help-btn {
            position: absolute; top: 15px; right: 15px;
            width: 32px; height: 32px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid var(--text-gold);
            border-radius: 50%;
            color: var(--text-gold);
            display: flex; justify-content: center; align-items: center;
            font-weight: bold; cursor: pointer; z-index: 200;
            font-size: 1.1rem;
            transition: all 0.2s;
        }
        .help-btn:hover { background: var(--text-gold); color: #1a1a2e; transform: scale(1.1); }

        .top-info-section { 
            display: flex; justify-content: space-between; align-items: center; 
            padding: 5px 20px; background: rgba(0,0,0,0.2); 
            border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; margin-bottom: 5px;
        }
        .info-box { text-align: center; } 
        .info-label { font-size: 0.8rem; color: #aaa; letter-spacing: 1px; } 
        .info-value { font-size: 1.2rem; font-family: 'Roboto', sans-serif; color: #fff; font-weight: bold; }
        #game-status-bar { font-family: 'Roboto', sans-serif; font-size: 1.5rem; font-weight: bold; color: white; text-align: center; width: 250px;}
        .static-dice-container { display: flex; gap: 10px; }
        .die-3d { width: 45px; height: 45px; background: #fff; border-radius: 10px; box-shadow: 2px 2px 5px rgba(0,0,0,0.6); display: flex; justify-content: center; align-items: center; font-size: 32px; color: #333; font-weight: bold; line-height: 1; }

        .top-section-layout { display: grid; grid-template-columns: 100px 1fr 100px; gap: 0; height: 180px; margin-bottom: 2px; }
        .side-box { border: 1px solid rgba(255,255,255,0.1); display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; padding: 5px; z-index: 1; }
        .side-box h1 { font-size: 1.8rem; margin: 0; color: var(--text-white); }
        .center-grid { display: grid; grid-template-columns: repeat(3, 1fr) 1.5fr repeat(3, 1fr); grid-template-rows: 1fr 1fr; gap: 0; grid-template-areas: "t1 t2 t3 any t4 t5 t6" "d1 d2 d3 any d4 d5 d6"; }
        
        #btn-TRIPLE_1 { grid-area: t1; } #btn-TRIPLE_2 { grid-area: t2; } #btn-TRIPLE_3 { grid-area: t3; } #btn-TRIPLE_4 { grid-area: t4; } #btn-TRIPLE_5 { grid-area: t5; } #btn-TRIPLE_6 { grid-area: t6; }
        #btn-DOUBLE_1 { grid-area: d1; } #btn-DOUBLE_2 { grid-area: d2; } #btn-DOUBLE_3 { grid-area: d3; } #btn-DOUBLE_4 { grid-area: d4; } #btn-DOUBLE_5 { grid-area: d5; } #btn-DOUBLE_6 { grid-area: d6; }
        #btn-ANY_TRIPLE { grid-area: any; background: rgba(255,255,255,0.05); }

        .totals-row { display: grid; grid-template-columns: repeat(14, 1fr); gap: 0; height: 60px; }
        .total-item { justify-content: space-between; padding: 5px 0; background: rgba(255,255,255,0.03); }
        .total-num { font-size: 1.2rem; font-weight: bold; color: #fff; font-family: 'Roboto'; }

        .combos-row { display: grid; grid-template-columns: 60px 1fr; gap: 0; height: 70px; margin-top: 2px; border: 1px solid rgba(255,255,255,0.1); }
        .combo-grid { display: grid; grid-template-columns: repeat(15, 1fr); gap: 0; } 

        .singles-row { display: grid; grid-template-columns: 60px 1fr; gap: 0; height: 80px; margin-top: -1px; border: 1px solid rgba(255,255,255,0.1); border-top: none; }
        .singles-grid { display: grid; grid-template-columns: repeat(6, 1fr); gap: 0; } 

        .bottom-controls { margin-top: 5px; display: flex; justify-content: space-between; align-items: center; padding: 5px 15px; background: rgba(0,0,0,0.2); border-radius: 8px; border: 1px solid rgba(255,255,255,0.1); }
        .point-selector { display: flex; gap: 8px; flex-wrap: wrap; justify-content: center; }
        .point-token { 
            width: 45px; height: 45px; border-radius: 50%; 
            display: flex; justify-content: center; align-items: center; cursor: pointer; 
            background: #2a2a40; border: 2px solid var(--accent-color); 
            color: white; font-weight: bold; font-size: 0.7rem;
            transition: transform 0.2s;
        }
        .point-token.selected { transform: translateY(-5px); border-color: var(--text-gold); background: var(--text-gold); color: black; }
        
        .btn { padding: 10px 20px; border-radius: 6px; border: none; font-weight: bold; font-family: 'Roboto'; cursor: pointer; font-size: 1rem; }
        .btn-clear { background: #546e7a; color: white; margin-left: 10px; }
        
        .option-box { 
            border: 1px solid rgba(255, 255, 255, 0.1); background: transparent; 
            cursor: pointer; display: flex; flex-direction: column; align-items: center; justify-content: center; 
            position: relative; margin: -1px; z-index: 1; overflow: visible; padding: 2px; 
        }
        .option-box:hover { background: rgba(255, 255, 255, 0.05); z-index: 2; border-color: rgba(255,255,255,0.3); }
        .option-box.active { background: rgba(233, 69, 96, 0.2); border: 1px solid var(--text-gold); z-index: 5; }
        .option-box.winner { background: rgba(0, 255, 204, 0.2) !important; border: 2px solid #00ffcc !important; box-shadow: inset 0 0 20px rgba(0,255,204,0.3); z-index: 10; }
        
        .point-badge { position: absolute; top: -5px; right: -5px; width: 24px; height: 24px; background: var(--text-gold); border-radius: 50%; color: white; font-size: 0.6rem; font-weight: bold; display: flex; justify-content: center; align-items: center; z-index: 20; box-shadow: 2px 2px 5px rgba(0,0,0,0.5); }
        
        .main-text { font-family: 'Roboto'; font-weight: bold; color: #fff; line-height: 1.1; font-size: 0.9rem; }
        .rule-text { font-size: 0.6rem; color: #aaa; margin-top: 2px; }
        .reward-text { font-size: 0.7rem; color: #aaa; font-weight: normal; margin-top: 1px; }
        
        .nickname-display { font-size: 1.1rem; color: #ffffff; cursor: pointer; font-weight: bold; text-decoration: none; margin-bottom: 5px; }
        .nickname-display:hover { color: #cccccc; }

        /* ë¬´ë£Œ ì ìˆ˜ ì¶©ì „ UI */
        #free-charge-panel {
            position: absolute;
            bottom: 20px; right: 20px;
            background: rgba(16, 16, 30, 0.95);
            border: 2px solid var(--text-gold);
            padding: 15px; border-radius: 12px;
            display: none; 
            flex-direction: column; align-items: center;
            box-shadow: 0 0 15px rgba(233, 69, 96, 0.3);
            z-index: 4000;
        }
        .free-charge-title { color: var(--text-gold); font-size: 0.9rem; font-weight: bold; margin-bottom: 8px; }
        .btn-claim { background: #00ffcc; border: none; padding: 8px 20px; border-radius: 5px; color: black; font-weight: bold; cursor: pointer; font-size: 0.9rem; }
        .btn-claim:hover { transform: scale(1.05); }

        #toast-warning { position: fixed; bottom: 150px; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.9); color: #ff5252; padding: 15px 30px; border-radius: 30px; border: 2px solid #ff5252; display: none; z-index: 3000; font-weight: bold; }
        #toast-warning.show { display: block; animation: fadein 0.3s; }
        @keyframes fadein { from { opacity: 0; transform: translate(-50%, 20px); } to { opacity: 1; transform: translate(-50%, 0); } }

        #nickname-modal, #disclaimer-modal, #help-modal { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.95); z-index: 5000; 
            display: none; justify-content: center; align-items: center; 
        }
        #nickname-modal.show, #disclaimer-modal.show, #help-modal.show { display: flex; }
        
        .modal-box { 
            background: #1a1a2e; border: 2px solid var(--text-gold); padding: 40px; 
            border-radius: 20px; text-align: center; box-shadow: 0 0 50px rgba(0,0,0,0.8); max-width: 400px; width: 90%;
        }
        .help-content { text-align: left; margin: 20px 0; max-height: 60vh; overflow-y: auto; color: #ddd; font-size: 0.9rem; line-height: 1.6; }
        .help-content h3 { color: var(--text-gold); margin-top: 0; border-bottom: 1px solid #555; padding-bottom: 5px; }
        .help-content ul { padding-left: 20px; }
        .help-content li { margin-bottom: 5px; }

        .nick-input { 
            background: #2a2a40; border: 1px solid #555; color: white; 
            font-size: 1.2rem; padding: 10px; margin: 20px 0; border-radius: 5px; text-align: center; font-family: 'Roboto'; width: 100%;
        }
        .action-btn { 
            background: var(--text-gold); color: white; font-weight: bold; 
            padding: 12px 30px; font-size: 1rem; cursor: pointer; border: none; border-radius: 5px; width: 100%;
        }
        
        .disclaimer-text { color: #ccc; font-size: 0.9rem; line-height: 1.6; margin-bottom: 20px; text-align: left; }
        .disclaimer-title { color: var(--text-gold); font-size: 1.5rem; margin-bottom: 20px; font-weight: bold; }
    </style>
</head>
<body>

    <div class="ad-top-container">
        <ins class="adsbygoogle"
             style="display:block"
             data-ad-client="ca-pub-1641440800882293"
             data-ad-slot="9359705956"
             data-ad-format="auto"
             data-full-width-responsive="true"></ins>
        <script>
             (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
    </div>

    <div class="main-wrapper">
        <div class="ad-vertical-container">
            <ins class="adsbygoogle"
                 style="display:block"
                 data-ad-client="ca-pub-1641440800882293"
                 data-ad-slot="5751633432"
                 data-ad-format="auto"
                 data-full-width-responsive="true"></ins>
            <script>
                 (adsbygoogle = window.adsbygoogle || []).push({});
            </script>
        </div>

        <div class="game-container" id="gameContainer">
            <div class="side-panel" id="historyPanel">
                <div class="toggle-btn history-toggle-btn" onclick="togglePanel('historyPanel', 'gameContainer', 'left')">â—€</div>
                <div class="panel-content">
                    <div class="panel-title">HISTORY</div>
                    <div class="scroll-list" id="historyList"></div>
                </div>
            </div>

            <div class="game-board-border">
                <div class="help-btn" onclick="openHelp()">?</div>

                <div class="game-board-inner">
                    <div class="top-info-section">
                        <div class="info-box">
                            <div class="info-label">SCORE</div>
                            <div class="info-value" id="points">0</div>
                        </div>
                        
                        <div style="display:flex; flex-direction:column; align-items:center;">
                            <div id="my-nickname" class="nickname-display" onclick="openNickModal()">Guest</div>
                            <div id="game-status-bar">CONNECTING...</div>
                        </div>

                        <div class="static-dice-container">
                            <div class="die-3d" id="d1">?</div><div class="die-3d" id="d2">?</div><div class="die-3d" id="d3">?</div>
                        </div>
                        <div class="info-box"><div class="info-label">LAST RESULT</div><div class="info-value" id="win-amount" style="color:#00ffcc;">0</div></div>
                    </div>

                    <div class="top-section-layout">
                        <div class="option-box side-box small" onclick="predict('SMALL')" id="btn-SMALL"><h1>SMALL</h1><div class="rule-text">4-10</div><div class="reward-text">x1</div></div>
                        <div class="center-grid">
                            <div class="option-box" onclick="predict('TRIPLE_1')" id="btn-TRIPLE_1"><span class="dice-md">âš€</span><span class="reward-text">x180</span></div>
                            <div class="option-box" onclick="predict('TRIPLE_2')" id="btn-TRIPLE_2"><span class="dice-md">âš</span><span class="reward-text">x180</span></div>
                            <div class="option-box" onclick="predict('TRIPLE_3')" id="btn-TRIPLE_3"><span class="dice-md">âš‚</span><span class="reward-text">x180</span></div>
                            <div class="option-box" onclick="predict('ANY_TRIPLE')" id="btn-ANY_TRIPLE"><div class="main-text">ANY<br>TRIPLE</div><div class="dice-md">âš€âš‚âš…</div><div class="reward-text">x30</div></div>
                            <div class="option-box" onclick="predict('TRIPLE_4')" id="btn-TRIPLE_4"><span class="dice-md">âšƒ</span><span class="reward-text">x180</span></div>
                            <div class="option-box" onclick="predict('TRIPLE_5')" id="btn-TRIPLE_5"><span class="dice-md">âš„</span><span class="reward-text">x180</span></div>
                            <div class="option-box" onclick="predict('TRIPLE_6')" id="btn-TRIPLE_6"><span class="dice-md">âš…</span><span class="reward-text">x180</span></div>
                            
                            <div class="option-box" onclick="predict('DOUBLE_1')" id="btn-DOUBLE_1"><span class="dice-md">âš€âš€</span><span class="reward-text">x10</span></div>
                            <div class="option-box" onclick="predict('DOUBLE_2')" id="btn-DOUBLE_2"><span class="dice-md">âšâš</span><span class="reward-text">x10</span></div>
                            <div class="option-box" onclick="predict('DOUBLE_3')" id="btn-DOUBLE_3"><span class="dice-md">âš‚âš‚</span><span class="reward-text">x10</span></div>
                            <div class="option-box" onclick="predict('DOUBLE_4')" id="btn-DOUBLE_4"><span class="dice-md">âšƒâšƒ</span><span class="reward-text">x10</span></div>
                            <div class="option-box" onclick="predict('DOUBLE_5')" id="btn-DOUBLE_5"><span class="dice-md">âš„âš„</span><span class="reward-text">x10</span></div>
                            <div class="option-box" onclick="predict('DOUBLE_6')" id="btn-DOUBLE_6"><span class="dice-md">âš…âš…</span><span class="reward-text">x10</span></div>
                        </div>
                        <div class="option-box side-box big" onclick="predict('BIG')" id="btn-BIG"><h1>BIG</h1><div class="rule-text">11-17</div><div class="reward-text">x1</div></div>
                    </div>

                    <div class="totals-row">
                        <div class="option-box total-item" onclick="predict('TOTAL_4')" id="btn-TOTAL_4"><span class="total-num">4</span><span class="reward-text">x60</span></div>
                        <div class="option-box total-item" onclick="predict('TOTAL_5')" id="btn-TOTAL_5"><span class="total-num">5</span><span class="reward-text">x30</span></div>
                        <div class="option-box total-item" onclick="predict('TOTAL_6')" id="btn-TOTAL_6"><span class="total-num">6</span><span class="reward-text">x18</span></div>
                        <div class="option-box total-item" onclick="predict('TOTAL_7')" id="btn-TOTAL_7"><span class="total-num">7</span><span class="reward-text">x12</span></div>
                        <div class="option-box total-item" onclick="predict('TOTAL_8')" id="btn-TOTAL_8"><span class="total-num">8</span><span class="reward-text">x8</span></div>
                        <div class="option-box total-item" onclick="predict('TOTAL_9')" id="btn-TOTAL_9"><span class="total-num">9</span><span class="reward-text">x6</span></div>
                        <div class="option-box total-item" onclick="predict('TOTAL_10')" id="btn-TOTAL_10"><span class="total-num">10</span><span class="reward-text">x6</span></div>
                        <div class="option-box total-item" onclick="predict('TOTAL_11')" id="btn-TOTAL_11"><span class="total-num">11</span><span class="reward-text">x6</span></div>
                        <div class="option-box total-item" onclick="predict('TOTAL_12')" id="btn-TOTAL_12"><span class="total-num">12</span><span class="reward-text">x6</span></div>
                        <div class="option-box total-item" onclick="predict('TOTAL_13')" id="btn-TOTAL_13"><span class="total-num">13</span><span class="reward-text">x8</span></div>
                        <div class="option-box total-item" onclick="predict('TOTAL_14')" id="btn-TOTAL_14"><span class="total-num">14</span><span class="reward-text">x12</span></div>
                        <div class="option-box total-item" onclick="predict('TOTAL_15')" id="btn-TOTAL_15"><span class="total-num">15</span><span class="reward-text">x18</span></div>
                        <div class="option-box total-item" onclick="predict('TOTAL_16')" id="btn-TOTAL_16"><span class="total-num">16</span><span class="reward-text">x30</span></div>
                        <div class="option-box total-item" onclick="predict('TOTAL_17')" id="btn-TOTAL_17"><span class="total-num">17</span><span class="reward-text">x60</span></div>
                    </div>

                    <div class="combos-row">
                        <div class="row-label"><div class="main-text">TWO</div><div class="reward-text">x5</div></div>
                        <div class="combo-grid">
                            <div class="option-box" onclick="predict('COMBO_1_2')" id="btn-COMBO_1_2"><div class="domino"><span class="dice-sm">âš€</span><span class="dice-sm">âš</span></div></div>
                            <div class="option-box" onclick="predict('COMBO_1_3')" id="btn-COMBO_1_3"><div class="domino"><span class="dice-sm">âš€</span><span class="dice-sm">âš‚</span></div></div>
                            <div class="option-box" onclick="predict('COMBO_1_4')" id="btn-COMBO_1_4"><div class="domino"><span class="dice-sm">âš€</span><span class="dice-sm">âšƒ</span></div></div>
                            <div class="option-box" onclick="predict('COMBO_1_5')" id="btn-COMBO_1_5"><div class="domino"><span class="dice-sm">âš€</span><span class="dice-sm">âš„</span></div></div>
                            <div class="option-box" onclick="predict('COMBO_1_6')" id="btn-COMBO_1_6"><div class="domino"><span class="dice-sm">âš€</span><span class="dice-sm">âš…</span></div></div>
                            <div class="option-box" onclick="predict('COMBO_2_3')" id="btn-COMBO_2_3"><div class="domino"><span class="dice-sm">âš</span><span class="dice-sm">âš‚</span></div></div>
                            <div class="option-box" onclick="predict('COMBO_2_4')" id="btn-COMBO_2_4"><div class="domino"><span class="dice-sm">âš</span><span class="dice-sm">âšƒ</span></div></div>
                            <div class="option-box" onclick="predict('COMBO_2_5')" id="btn-COMBO_2_5"><div class="domino"><span class="dice-sm">âš</span><span class="dice-sm">âš„</span></div></div>
                            <div class="option-box" onclick="predict('COMBO_2_6')" id="btn-COMBO_2_6"><div class="domino"><span class="dice-sm">âš</span><span class="dice-sm">âš…</span></div></div>
                            <div class="option-box" onclick="predict('COMBO_3_4')" id="btn-COMBO_3_4"><div class="domino"><span class="dice-sm">âš‚</span><span class="dice-sm">âšƒ</span></div></div>
                            <div class="option-box" onclick="predict('COMBO_3_5')" id="btn-COMBO_3_5"><div class="domino"><span class="dice-sm">âš‚</span><span class="dice-sm">âš„</span></div></div>
                            <div class="option-box" onclick="predict('COMBO_3_6')" id="btn-COMBO_3_6"><div class="domino"><span class="dice-sm">âš‚</span><span class="dice-sm">âš…</span></div></div>
                            <div class="option-box" onclick="predict('COMBO_4_5')" id="btn-COMBO_4_5"><div class="domino"><span class="dice-sm">âšƒ</span><span class="dice-sm">âš„</span></div></div>
                            <div class="option-box" onclick="predict('COMBO_4_6')" id="btn-COMBO_4_6"><div class="domino"><span class="dice-sm">âšƒ</span><span class="dice-sm">âš…</span></div></div>
                            <div class="option-box" onclick="predict('COMBO_5_6')" id="btn-COMBO_5_6"><div class="domino"><span class="dice-sm">âš„</span><span class="dice-sm">âš…</span></div></div>
                        </div>
                    </div>

                    <div class="singles-row">
                        <div class="row-label"><div class="main-text">ONE</div><div class="reward-text">x1~3</div></div>
                        <div class="singles-grid">
                            <div class="option-box single-box" onclick="predict('SINGLE_1')" id="btn-SINGLE_1"><span class="dice-lg">âš€</span></div>
                            <div class="option-box single-box" onclick="predict('SINGLE_2')" id="btn-SINGLE_2"><span class="dice-lg">âš</span></div>
                            <div class="option-box single-box" onclick="predict('SINGLE_3')" id="btn-SINGLE_3"><span class="dice-lg">âš‚</span></div>
                            <div class="option-box single-box" onclick="predict('SINGLE_4')" id="btn-SINGLE_4"><span class="dice-lg">âšƒ</span></div>
                            <div class="option-box single-box" onclick="predict('SINGLE_5')" id="btn-SINGLE_5"><span class="dice-lg">âš„</span></div>
                            <div class="option-box single-box" onclick="predict('SINGLE_6')" id="btn-SINGLE_6"><span class="dice-lg">âš…</span></div>
                        </div>
                    </div>

                    <div class="bottom-controls">
                        <div class="point-selector">
                            <div class="point-token selected" onclick="setPoint(1000, this)">1,000</div>
                            <div class="point-token" onclick="setPoint(5000, this)">5,000</div>
                            <div class="point-token" onclick="setPoint(10000, this)">10K</div>
                            <div class="point-token" onclick="setPoint(50000, this)">50K</div>
                            <div class="point-token" onclick="setPoint(100000, this)">100K</div>
                        </div>
                        <button class="btn btn-clear" onclick="clearPredictions()">RESET</button>
                    </div>
                </div>
            </div>

            <div class="side-panel" id="rankingPanel">
                <div class="toggle-btn ranking-toggle-btn" onclick="togglePanel('rankingPanel', 'gameContainer', 'right')">â–¶</div>
                <div class="panel-content">
                    <div class="panel-title">TOP RANKING</div>
                    <div class="scroll-list" id="rankingList"></div>
                </div>
            </div>
        </div>

        <div class="ad-vertical-container">
            <ins class="adsbygoogle"
                 style="display:block"
                 data-ad-client="ca-pub-1641440800882293"
                 data-ad-slot="5751633432"
                 data-ad-format="auto"
                 data-full-width-responsive="true"></ins>
            <script>
                 (adsbygoogle = window.adsbygoogle || []).push({});
            </script>
        </div>
    </div>

    <div id="free-charge-panel">
        <div class="free-charge-title">FREE CHARGE</div>
        <button class="btn-claim" onclick="claimFreeScore()">100,000ì  ë°›ê¸°</button>
    </div>

    <div class="ad-bottom-container">
        <ins class="adsbygoogle"
             style="display:block"
             data-ad-client="ca-pub-1641440800882293"
             data-ad-slot="9359705956"
             data-ad-format="auto"
             data-full-width-responsive="true"></ins>
        <script>
             (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
    </div>

<div id="disclaimer-modal" class="show">
    <div class="modal-box">
        <div class="disclaimer-title">NOTICE</div>
        <div class="disclaimer-text">
            ë³¸ ì„œë¹„ìŠ¤ëŠ” ì˜¤ë½ ëª©ì ì˜ ë‹¨ìˆœ ê²Œì„ì…ë‹ˆë‹¤.<br><br>
            â€¢ ê²Œì„ ë‚´ ì ìˆ˜(Score)ëŠ” í˜„ê¸ˆ ê°€ì¹˜ê°€ ì—†ìŠµë‹ˆë‹¤.<br>
            â€¢ ì ìˆ˜ëŠ” í™˜ì „, ì–‘ë„, ê±°ë˜ê°€ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.<br>
            â€¢ ì–´ë– í•œ í˜•íƒœì˜ ê¸ˆì „ì  ë³´ìƒë„ ì œê³µí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
        </div>
        <button class="action-btn" onclick="closeDisclaimer()">I UNDERSTAND</button>
    </div>
</div>

<div id="help-modal">
    <div class="modal-box">
        <h2 style="color:var(--text-gold); margin-top:0;">GAME GUIDE</h2>
        <div class="help-content">
            <h3>ğŸ² í”Œë ˆì´ ë°©ë²•</h3>
            <ul>
                <li>ì£¼ì‚¬ìœ„ 3ê°œì˜ ê²°ê³¼ë¥¼ <strong>ì˜ˆì¸¡</strong>í•˜ì—¬ ì›í•˜ëŠ” êµ¬ì—­ì„ ì„ íƒí•˜ì„¸ìš”.</li>
                <li><strong>SELECT</strong> ì‹œê°„ì— ì ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ ì˜ˆì¸¡ì— ì°¸ì—¬í•©ë‹ˆë‹¤.</li>
                <li><strong>RESULT</strong> ì‹œê°„ì— ê²°ê³¼ê°€ ì ì¤‘í•˜ë©´ <strong>ì ìˆ˜ ë³´ìƒ</strong>ì„ íšë“í•©ë‹ˆë‹¤.</li>
            </ul>

            <h3>âš¡ ë¬´ë£Œ ì¶©ì „ì†Œ</h3>
            <ul>
                <li>ë³´ìœ  ì ìˆ˜ê°€ <strong>1,000ì  ì´í•˜</strong>ì¼ ë•Œ í™œì„±í™”ë©ë‹ˆë‹¤.</li>
                <li>ë¼ìš´ë“œë‹¹ 1íšŒ, ì¦‰ì‹œ <strong>100,000ì </strong>ì„ ë¬´ë£Œë¡œ ë“œë¦½ë‹ˆë‹¤.</li>
            </ul>

            <h3>ğŸ† ì ìˆ˜ íšë“ ë°°ìœ¨</h3>
            <ul>
                <li><strong>SMALL (4-10):</strong> 1ë°° (ë‹¨, Triple ì œì™¸)</li>
                <li><strong>BIG (11-17):</strong> 1ë°° (ë‹¨, Triple ì œì™¸)</li>
                <li><strong>Triple (íŠ¸ë¦¬í”Œ):</strong> 180ë°°</li>
                <li><strong>Any Triple:</strong> 30ë°°</li>
                <li><strong>Double:</strong> 10ë°°</li>
            </ul>
        </div>
        <button class="action-btn" onclick="closeHelp()">CLOSE</button>
    </div>
</div>

<div id="nickname-modal">
    <div class="modal-box">
        <h2 style="color:var(--text-gold); margin-top:0;">NICKNAME</h2>
        <input type="text" id="nick-input" class="nick-input" placeholder="Your Name" maxlength="8">
        <button class="action-btn" onclick="submitNickname()">SAVE NAME</button>
    </div>
</div>

<div id="toast-warning"></div>

<script>
    let USER_ID = localStorage.getItem('sicbo_uid');
    let SESSION_TOKEN = localStorage.getItem('sicbo_token');

    let currentPoint = 1000;
    let myPredictions = {};
    let localScore = 0;
    let isProcessing = false;
    let myNickname = null;

    const diceChars = ['âš€','âš','âš‚','âšƒ','âš„','âš…'];

    async function initAuth() {
        try {
            const res = await fetch('/api/auth', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ uid: USER_ID })
            });
            const data = await res.json();
            if (data.success) {
                USER_ID = data.uid;
                SESSION_TOKEN = data.token;
                localStorage.setItem('sicbo_uid', USER_ID);
                localStorage.setItem('sicbo_token', SESSION_TOKEN);
                
                setInterval(fetchGameStatus, 200);
            }
        } catch(e) { console.error("Auth failed", e); }
    }
    
    initAuth();

    function closeDisclaimer() {
        document.getElementById('disclaimer-modal').classList.remove('show');
        checkNicknameNeeded();
    }

    function openHelp() {
        document.getElementById('help-modal').classList.add('show');
    }
    function closeHelp() {
        document.getElementById('help-modal').classList.remove('show');
    }

    async function fetchGameStatus() {
        if (!SESSION_TOKEN) return;

        try {
            const res = await fetch('/status?t=' + Date.now(), {
                headers: { 'Authorization': 'Bearer ' + SESSION_TOKEN }
            });
            const data = await res.json();
            
            myNickname = data.nickname;
            document.getElementById('my-nickname').innerText = (myNickname || "Guest");
            
            if (!isProcessing) {
                localScore = data.score; 
            }
            updateUI(data);
        } catch(e) { console.error(e); }
    }
    
    // [NEW] ë¬´ë£Œ ì¶©ì „ UI (1íŒ 1íšŒ ì œí•œ ë°˜ì˜)
    function updateFreeChargeUI(data) {
        const panel = document.getElementById('free-charge-panel');
        // ì ìˆ˜ 1000 ì´í•˜ AND ì´ë²ˆ íŒì— ì•„ì§ ì•ˆ ë°›ì•˜ì„ ë•Œë§Œ í‘œì‹œ
        if (data.score <= 1000 && !data.already_claimed) {
            panel.style.display = 'flex';
        } else {
            panel.style.display = 'none';
        }
    }
    
    async function claimFreeScore() {
        try {
            const res = await fetch('/api/claim_free', {
                method: 'POST',
                headers: { 'Authorization': 'Bearer ' + SESSION_TOKEN }
            });
            const data = await res.json();
            if(data.success) {
                showWarning(data.msg);
                fetchGameStatus();
            } else {
                showWarning(data.msg);
            }
        } catch(e) { console.error(e); }
    }

    function checkNicknameNeeded() {
        if ((!myNickname || myNickname === 'Guest') && !document.getElementById('nickname-modal').classList.contains('hidden-by-user')) {
            document.getElementById('nickname-modal').classList.add('show');
        }
    }

    async function submitNickname() {
        const input = document.getElementById('nick-input');
        const newNick = input.value.trim();
        if (!newNick) return showWarning("ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ì„¸ìš”.");

        document.getElementById('nickname-modal').classList.remove('show');
        document.getElementById('nickname-modal').classList.add('hidden-by-user');
        document.getElementById('my-nickname').innerText = newNick;

        try {
            const res = await fetch('/user/nickname', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': 'Bearer ' + SESSION_TOKEN
                },
                body: JSON.stringify({ nickname: newNick })
            });
            const result = await res.json();
            
            if (result.success) {
                showWarning("ë‹‰ë„¤ì„ì´ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.");
            } else {
                showWarning(result.msg);
            }
        } catch(e) { console.error(e); }
    }

    function openNickModal() {
        document.getElementById('nickname-modal').classList.add('show');
    }

    function updateUI(data) {
        const statusEl = document.getElementById('game-status-bar');
        
        if(data.state === 'SELECTION') {
            statusEl.innerText = `SELECT: ${data.timer}s`;
            statusEl.style.color = "#00ffcc";
        } else if(data.state === 'RESULT') {
            statusEl.innerText = `RESULT: ${data.timer}s`;
            statusEl.style.color = "#ff3366";
        }
        
        document.getElementById('points').innerText = formatPoints(localScore);
        
        if (!isProcessing) {
            myPredictions = data.my_selections;
            renderPredictions(myPredictions);
        }
        
        renderHistory(data.history);
        renderRanking(data.ranking);

        const winEl = document.getElementById('win-amount');
        const resultVal = data.round_result || 0;
        
        if (resultVal > 0) {
            winEl.innerText = "+" + formatPoints(resultVal);
            winEl.style.color = "#00ffcc";
        } else if (resultVal < 0) {
            winEl.innerText = formatPoints(resultVal);
            winEl.style.color = "#ff3366";
        } else {
            winEl.innerText = "0";
            winEl.style.color = "#fff";
        }

        const box = document.querySelector('.static-dice-container');
        if(data.state === 'RESULT') {
            let html = '';
            data.dice.forEach(d => {
                html += `<div class="die-3d">${diceChars[d-1]}</div>`;
            });
            box.innerHTML = html;
        } else {
            box.innerHTML = `<div class="die-3d">?</div><div class="die-3d">?</div><div class="die-3d">?</div>`;
        }
        
        document.querySelectorAll('.winner').forEach(el => el.classList.remove('winner'));
        if(data.outcomes && data.outcomes.length > 0) {
            data.outcomes.forEach(w => {
                const btn = document.getElementById('btn-' + w);
                if(btn) btn.classList.add('winner');
            });
        }

        updateFreeChargeUI(data);
    }

    function renderRanking(ranking) {
        const listEl = document.getElementById('rankingList');
        if (!ranking) return;
        let html = '';
        ranking.forEach((user, index) => {
            const isMe = user.uid === USER_ID ? 'rank-me' : '';
            html += `<div class="ranking-item ${isMe}"><div class="rank-rank">${index + 1}</div><div class="rank-user">${user.nickname}</div><div class="rank-bal">${formatPoints(user.score)}</div></div>`;
        });
        listEl.innerHTML = html;
    }

    function togglePanel(panelId, containerId, side) {
        const panel = document.getElementById(panelId);
        const btn = panel.querySelector('.toggle-btn');
        panel.classList.toggle('collapsed');
        if (side === 'left') btn.innerText = panel.classList.contains('collapsed') ? 'â–¶' : 'â—€';
        else btn.innerText = panel.classList.contains('collapsed') ? 'â—€' : 'â–¶';
    }

    async function predict(type) {
        const statusText = document.getElementById('game-status-bar').innerText;
        if(!statusText.includes("SELECT")) return showWarning("ì„ íƒ ì‹œê°„ì´ ì•„ë‹™ë‹ˆë‹¤.");
        if(localScore < currentPoint) return showWarning("ì ìˆ˜ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤.");

        isProcessing = true;
        localScore -= currentPoint;
        document.getElementById('points').innerText = formatPoints(localScore);
        
        if(!myPredictions[type]) myPredictions[type] = 0;
        myPredictions[type] += currentPoint;
        renderPredictions(myPredictions);

        try {
            const res = await fetch('/predict', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': 'Bearer ' + SESSION_TOKEN
                },
                body: JSON.stringify({ prediction_type: type, points: currentPoint })
            });
            const result = await res.json();
            if(!result.success) {
                showWarning(result.msg);
                isProcessing = false;
                fetchGameStatus(); 
            } else {
                setTimeout(() => { isProcessing = false; }, 300);
            }
        } catch(e) { isProcessing = false; }
    }

    async function clearPredictions() {
        const statusText = document.getElementById('game-status-bar').innerText;
        if(!statusText.includes("SELECT")) return showWarning("ì·¨ì†Œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        isProcessing = true;
        myPredictions = {};
        renderPredictions(myPredictions);
        try {
            const res = await fetch('/predict/clear', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': 'Bearer ' + SESSION_TOKEN
                }
            });
            const result = await res.json();
            if(result.success) {
                isProcessing = false;
                fetchGameStatus();
            } else {
                showWarning(result.msg);
                isProcessing = false;
            }
        } catch(e) { isProcessing = false; }
    }

    function formatPoints(num) { 
        return num.toLocaleString(); 
    }

    function renderPredictions(predictions) {
        document.querySelectorAll('.point-badge').forEach(e => e.remove());
        document.querySelectorAll('.active').forEach(e => e.classList.remove('active'));
        if(!predictions) return;
        for(const [type, points] of Object.entries(predictions)) {
            const btn = document.getElementById('btn-' + type);
            if(btn) {
                btn.classList.add('active');
                const badge = document.createElement('div');
                badge.className = 'point-badge';
                badge.innerText = (points >= 1000 ? (points/1000) + 'k' : points);
                btn.appendChild(badge);
            }
        }
    }

    function renderHistory(history) {
        const listEl = document.getElementById('historyList');
        if(!history || listEl.childElementCount === history.length) return; 
        listEl.innerHTML = "";
        history.forEach(item => {
            const div = document.createElement('div');
            div.className = 'history-item';
            let diceHtml = `<div class="h-dice-group">`;
            item.dice.forEach(d => { diceHtml += `<span class="h-die">${diceChars[d-1]}</span>`; });
            diceHtml += `</div>`;
            div.innerHTML = diceHtml;
            listEl.appendChild(div);
        });
    }

    function setPoint(val, el) {
        currentPoint = val;
        document.querySelectorAll('.point-token').forEach(c => c.classList.remove('selected'));
        el.classList.add('selected');
    }

    function showWarning(msg) {
        const toast = document.getElementById('toast-warning');
        toast.innerText = msg;
        toast.classList.add('show');
        setTimeout(() => { toast.classList.remove('show'); }, 2000);
    }
</script>

</body>
</html>